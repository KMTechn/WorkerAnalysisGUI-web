<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>성과 분석 대시보드</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <p id="loading-message">데이터 분석 중...</p>
        <p id="loading-submessage" style="font-size: 0.85rem; color: rgba(255,255,255,0.8); margin-top: 8px;">잠시만 기다려 주세요</p>
    </div>

    <!-- 모바일 햄버거 메뉴 버튼 -->
    <button class="mobile-menu-btn" id="mobile-menu-btn">☰</button>

    <!-- 사이드바 오버레이 (모바일) -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <h2>성과 분석 대시보드</h2>
                <span id="app-version">v3.2.0-web</span>
            </header>

            <nav class="filters">
                <div class="filter-group">
                    <label class="filter-label">공정 선택</label>
                    <div id="process-mode-radios">
                        <label><input type="radio" name="process_mode" value="이적실" checked> 이적실 분석</label>
                        <label><input type="radio" name="process_mode" value="검사실"> 검사실 분석</label>
                        <label><input type="radio" name="process_mode" value="포장실"> 포장실 분석</label>
                        <label><input type="radio" name="process_mode" value="전체 비교"> 전체 비교</label>
                    </div>
                </div>

                <div class="filter-group">
                    <label for="log-folder-path" class="filter-label">로그 폴더</label>
                    <p id="log-folder-path" class="log-folder-display">C:\Sync</p>
                </div>

                <div class="filter-group">
                    <label class="filter-label">바코드 검색</label>
                    <div class="barcode-search">
                        <input type="text" id="barcode-input" placeholder="바코드 입력" class="barcode-input-field">
                        <button id="search-barcode-btn" class="btn btn-primary">검색</button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <h1 id="main-title">대시보드</h1>
            </header>

            <div class="tabs">
                <!-- 탭 버튼들은 JS로 동적 생성 -->
            </div>

            <div class="tab-content">
                <!-- 탭 콘텐츠들은 JS로 동적 생성 -->
            </div>
        </main>
    </div>

    <!-- 바코드 검색 모달 -->
    <div id="barcode-modal" class="barcode-modal" style="display: none;">
        <div class="barcode-modal-overlay" onclick="closeBarcodeModal()"></div>
        <div class="barcode-modal-content">
            <div class="barcode-modal-header">
                <h2>🔍 바코드 검색 결과</h2>
                <button class="barcode-modal-close" onclick="closeBarcodeModal()">&times;</button>
            </div>
            <div class="barcode-modal-body" id="barcode-modal-body">
                <!-- 검색 결과가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 작업자 생산량 그래프 모달 -->
    <div id="worker-chart-modal" class="barcode-modal" style="display: none;">
        <div class="barcode-modal-overlay" onclick="closeWorkerChartModal()"></div>
        <div class="barcode-modal-content" style="max-width: 900px; width: 95%;">
            <div class="barcode-modal-header">
                <h2 id="worker-chart-title">📊 작업자 시간당 생산량</h2>
                <button class="barcode-modal-close" onclick="closeWorkerChartModal()">&times;</button>
            </div>
            <div class="barcode-modal-body" id="worker-chart-body" style="padding: 20px;">
                <!-- 작업자 통계 요약 -->
                <div id="worker-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 20px;"></div>
                <!-- 시간대별 생산량 그래프 -->
                <div style="background: #f9fafb; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #374151;">시간대별 평균 생산량</h4>
                    <div style="height: 250px;">
                        <canvas id="worker-hourly-chart"></canvas>
                    </div>
                </div>
                <!-- 일별 생산량 그래프 -->
                <div style="background: #f9fafb; border-radius: 8px; padding: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #374151;">일별 생산량</h4>
                    <div style="height: 200px;">
                        <canvas id="worker-daily-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='dashboard_enhanced.js') }}?v={{ cache_buster }}"></script>
    <!-- 향상된 버전: 차트 + 기간 필터 추가 (데이터 포인트 제한으로 안정성 확보) -->
</body>
</html>