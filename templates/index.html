<!DOCTYPE html>
<html lang="ko" dir="ltr">
<head>
    <meta name="description" content="KMTech 작업자 성과 분석 대시보드 - 이적실, 검사실, 포장실 작업 데이터 분석">
    <meta name="theme-color" content="#18181b">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>성과 분석 대시보드</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <!-- 통합 상단 네비게이션 -->
    <nav class="top-nav" role="navigation" aria-label="메인 네비게이션">
        <div class="top-nav-inner">
            <a href="/" class="nav-logo" aria-label="KMTech 홈으로 이동">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="KMTech 로고" class="logo-img">
            </a>
            <a href="/" class="nav-link active" aria-current="page">👥 작업자 분석</a>
            <a href="/stock/" class="nav-link">📦 재고 원장</a>
            <span class="nav-brand" aria-hidden="true">KMTech 통합 대시보드</span>
        </div>
    </nav>

    <div class="loading-overlay" id="loading-overlay" role="alert" aria-live="polite" aria-busy="true">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p id="loading-message">데이터 분석 중...</p>
        <p id="loading-submessage" style="font-size: 0.85rem; color: rgba(255,255,255,0.8); margin-top: 8px;">잠시만 기다려 주세요</p>
    </div>

    <!-- 모바일 햄버거 메뉴 버튼 -->
    <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="메뉴 열기" aria-expanded="false" aria-controls="sidebar">☰</button>

    <!-- 사이드바 오버레이 (모바일) -->
    <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" role="complementary" aria-label="필터 및 설정">
            <header class="sidebar-header">
                <h2>성과 분석 대시보드</h2>
                <span id="app-version" aria-label="앱 버전">v3.2.0-web</span>
            </header>

            <nav class="filters" aria-label="데이터 필터">
                <div class="filter-group" role="group" aria-labelledby="process-label">
                    <label class="filter-label" id="process-label">공정 선택</label>
                    <div id="process-mode-radios" role="radiogroup" aria-labelledby="process-label">
                        <label><input type="radio" name="process_mode" value="이적실" checked aria-checked="true"> 이적실 분석</label>
                        <label><input type="radio" name="process_mode" value="검사실" aria-checked="false"> 검사실 분석</label>
                        <label><input type="radio" name="process_mode" value="포장실" aria-checked="false"> 포장실 분석</label>
                        <label><input type="radio" name="process_mode" value="전체 비교" aria-checked="false"> 전체 비교</label>
                    </div>
                </div>

                <div class="filter-group">
                    <label for="log-folder-path" class="filter-label">로그 폴더</label>
                    <p id="log-folder-path" class="log-folder-display">C:\Sync</p>
                </div>

                <div class="filter-group" role="search">
                    <label class="filter-label" for="barcode-input">바코드 검색</label>
                    <div class="barcode-search">
                        <input type="text" id="barcode-input" placeholder="바코드 입력" class="barcode-input-field" aria-label="바코드 검색어 입력">
                        <button id="search-barcode-btn" class="btn btn-primary" aria-label="바코드 검색">검색</button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" role="main" aria-label="대시보드 메인 콘텐츠">
            <header class="main-header">
                <h1 id="main-title">대시보드</h1>
            </header>

            <div class="tabs" role="tablist" aria-label="분석 탭">
                <!-- 탭 버튼들은 JS로 동적 생성 -->
            </div>

            <div class="tab-content" role="tabpanel" aria-live="polite">
                <!-- 탭 콘텐츠들은 JS로 동적 생성 -->
            </div>
        </main>
    </div>

    <!-- 바코드 검색 모달 -->
    <div id="barcode-modal" class="barcode-modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="barcode-modal-title">
        <div class="barcode-modal-overlay" onclick="closeBarcodeModal()" aria-hidden="true"></div>
        <div class="barcode-modal-content">
            <div class="barcode-modal-header">
                <h2 id="barcode-modal-title">🔍 바코드 검색 결과</h2>
                <button class="barcode-modal-close" onclick="closeBarcodeModal()" aria-label="닫기">&times;</button>
            </div>
            <div class="barcode-modal-body" id="barcode-modal-body">
                <!-- 검색 결과가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 작업자 생산량 그래프 모달 -->
    <div id="worker-chart-modal" class="barcode-modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="worker-chart-title">
        <div class="barcode-modal-overlay" onclick="closeWorkerChartModal()" aria-hidden="true"></div>
        <div class="barcode-modal-content" style="max-width: 900px; width: 95%;">
            <div class="barcode-modal-header">
                <h2 id="worker-chart-title">📊 작업자 시간당 생산량</h2>
                <button class="barcode-modal-close" onclick="closeWorkerChartModal()" aria-label="닫기">&times;</button>
            </div>
            <div class="barcode-modal-body" id="worker-chart-body" style="padding: 20px;">
                <!-- 작업자 통계 요약 -->
                <div id="worker-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 20px;"></div>
                <!-- 시간대별 생산량 그래프 -->
                <div style="background: #f9fafb; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #374151;">시간대별 평균 생산량</h4>
                    <div style="height: 250px;">
                        <canvas id="worker-hourly-chart"></canvas>
                    </div>
                </div>
                <!-- 일별 생산량 그래프 -->
                <div style="background: #f9fafb; border-radius: 8px; padding: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #374151;">일별 생산량</h4>
                    <div style="height: 200px;">
                        <canvas id="worker-daily-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='dashboard_enhanced.js') }}?v={{ cache_buster }}"></script>
    <!-- 향상된 버전: 차트 + 기간 필터 추가 (데이터 포인트 제한으로 안정성 확보) -->
</body>
</html>